version: 1
mode: deterministic
owner: Finance Platform Team
criteria:
  - name: AP email ingestion creates intake record
    input: scenario_ap_email_ingest
    expected_behavior: Valid AP email invoice is ingested with source="AP email" and processing timestamp present.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.0
    tags: [acceptance, ingestion, ap_email]

  - name: Accounting sync ingestion creates intake record
    input: scenario_accounting_ingest
    expected_behavior: New accounting-system invoice is ingested with source="Accounting system" and sync timestamp present.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.0
    tags: [acceptance, ingestion, accounting]

  - name: Same-source duplicate suppression
    input: scenario_same_source_dedupe
    expected_behavior: Duplicate AP email invoice does not create a second queue record and duplicate event is recorded.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.2
    tags: [acceptance, dedupe, ap_email]

  - name: Cross-source duplicate suppression
    input: scenario_cross_source_dedupe
    expected_behavior: Email + accounting duplicates resolve to one queue record with both sources in ingestion history.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.2
    tags: [acceptance, dedupe, cross_source]

  - name: Analyst source filter and timestamp sort
    input: scenario_analyst_filter_sort
    expected_behavior: Analyst filter by source and descending timestamp sort return correct records and order.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.0
    tags: [acceptance, analyst_view, query]

  - name: AP email failure visibility
    input: scenario_ap_email_failure
    expected_behavior: AP email ingestion failure is logged with source/time/error type and exposed via status/alert path.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.0
    tags: [acceptance, failure, observability]

  - name: Accounting sync failure visibility
    input: scenario_accounting_failure
    expected_behavior: Accounting sync failure is logged with source/time/error type and exposed via status/alert path.
    eval_class: scenario_pass_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.0
    tags: [acceptance, failure, observability]

  - name: Ingestion latency SLA
    input: nfr_latency_15min
    expected_behavior: At least 95% of successful ingestions appear in queue within 15 minutes for both sources under normal load.
    eval_class: sla_compliance_rate
    threshold: 0.95
    fail_on: below_threshold
    weight: 1.2
    tags: [nfr, performance, sla]

  - name: Source reliability SLO
    input: nfr_reliability_30d
    expected_behavior: Each ingestion source maintains at least 99.7% successful ingestion over rolling 30-day windows (excluding planned maintenance).
    eval_class: success_rate
    threshold: 0.997
    fail_on: below_threshold
    weight: 1.3
    tags: [nfr, reliability, slo]

  - name: Failure log completeness
    input: nfr_failure_log_fields
    expected_behavior: Ingestion failure events include source, time, and error type fields for diagnostics.
    eval_class: required_fields_presence_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 1.0
    tags: [nfr, observability, diagnostics]

  - name: Throughput baseline support
    input: nfr_throughput_100_per_day
    expected_behavior: System processes at least 100 invoices/day without breaching ingestion SLA.
    eval_class: throughput_compliance_rate
    threshold: 1.0
    fail_on: below_threshold
    weight: 0.9
    tags: [nfr, scalability, throughput]

  - name: Ingestion history retention
    input: nfr_history_retention_24m
    expected_behavior: Source/timestamp/status ingestion history is retained for minimum 24 months.
    eval_class: retention_policy_compliance
    threshold: 1.0
    fail_on: below_threshold
    weight: 0.8
    tags: [nfr, compliance, auditability]
